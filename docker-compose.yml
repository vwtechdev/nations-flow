version: "3.9"

services:
  web:
    build: ./django
    container_name: nations-flow_web
    command: gunicorn core.wsgi:application --bind 0.0.0.0:8000
    volumes:
      - ./django:/app
      - ./static:/app/static
      - ./.env:/app/.env
    env_file: .env
    networks:
      - nations-flow_net
      - proxy
    labels:
      - "traefik.enable=true" 
      - "traefik.http.routers.nations-flow.rule=Host(`www.nationsflow.com.br`)"
      - "traefik.http.routers.nations-flow.entrypoints=websecure"
      - "traefik.http.routers.nations-flow.tls.certresolver=myresolver"
    restart: always

  db:
    image: postgres:15
    container_name: nations-flow_db
    volumes:
      - ./db_data:/var/lib/postgresql/data
    env_file: .env
    networks:
      - nations-flow_net
    restart: always

networks:
  nations-flow_net:
    driver: bridge
  proxy:
    external: true